<!doctype html>
<html>
	<head>
		<!-- The loading sequence is critical, and should not be changed,
        otherwise webview may show in blank because some variable cannot get the initial data
        (e.g. axios.js is missing so that we can't do POST in main.js ) -->
		<link href="{{root}}/resources/simulator/main.css" rel="stylesheet" />
		<link href="{{root}}/resources/simulator/iview.css" rel="stylesheet" />
		<script
			src="{{root}}/resources/simulator/scripts/vendor.js"
			type="text/javascript"></script>
		<!-- v-cloak will remain on the element until the associated Vue instance finishes compilation.
        Combined with CSS rules, this directive can be used to hide un-compiled mustache bindings until the Vue instance is ready.  -->
		<style type="text/css">
			[v-cloak] {
				display: none !important;
			}
		</style>
	</head>

	<body>
		<div id="app" v-cloak data-endpoint="{{endpoint}}">
			<Row>
				<i-col span="24" style="max-width: 800px; min-width: 400px">
					<Card :bordered="false" :dis-hover="true">
						<Row>
							<i-col span="24">
								<p>{{ introduction }}</p>
								<p style="margin-top: 20px">
									You are sending message(s) to
									<b>{{ hostName }}</b>
								</p>
								<br />
							</i-col>
						</Row>
						<i-form
							:model="formItem"
							:rules="ruleValidation"
							ref="formItem">
							<form-item
								label="Device(s) to send messages from"
								prop="deviceConnectionStrings">
								<Row>
									<i-col span="24">
										<i-select
											:remote-method="deviceSelectFilter"
											@on-change="persistInputs"
											@on-open-change="resetFilter"
											filterable
											multiple
											not-found-text="No Device Found"
											placeholder="Please select the device(s) you want to send message from..."
											remote
											v-model="formItem.deviceConnectionStrings">
											<i-option
												:key="item.connectionString"
												:value="item.connectionString"
												v-for="item in filteredInputDeviceList">
												{{item.label}}
											</i-option>
										</i-select>
									</i-col>
								</Row>
							</form-item>
							<Row :gutter="10">
								<i-col span="7" style="width: 200px">
									<form-item
										label="Message(s) per device"
										prop="numbers"
										style="text-align: left">
										<i-input
											@on-change="persistInputs"
											placeholder=""
											v-model="formItem.numbers">
										</i-input>
									</form-item>
								</i-col>
								<i-col span="10" style="width: 200px">
									<form-item
										label="Interval between two messages"
										prop="interval"
										style="text-align: left; width: 200px">
										<i-input
											@on-change="persistInputs"
											placeholder=""
											style="padding-top: 1px"
											v-model="formItem.interval">
											<!-- padding-top=1px: because the ivu-input with append or prepend slot will have -1 px in padding -->
											<i-select
												@on-change="persistInputs"
												slot="append"
												style="width: 120px"
												v-model="intervalUnit">
												<i-option value="millisecond"
													>millisecond(s)</i-option
												>
												<i-option value="second"
													>second(s)</i-option
												>
												<i-option value="minute"
													>minute(s)</i-option
												>
											</i-select>
										</i-input>
									</form-item>
								</i-col>
							</Row>
							<form-item label="Message" prop="message">
								<Row>
									<i-col span="24">
										<radio-group
											@on-change="messageBodyTypeChange"
											v-model="messageBodyType">
											<Radio label="Plain Text"
												>Plain Text</Radio
											>
											<Radio label="Dummy Json"
												>Data Template
												<Tooltip
													max-width="500"
													placement="top-start"
													theme="light"
													transfer>
													<!-- Set transfer=true, to append the layer in body.
                                          When used in Tabs or a fixed Table column, by adding this property,
                                          Tooltip will not be affected by the parent style, resulting in better results. -->
													<Icon
														size="18"
														type="md-information-circle"></Icon>
													<!-- In the content slot, content should begin from the left,
                                          otherwise unexpected space will be regarded as part of content -->
													<div slot="content">
														<p>
															Using Dummy JSON to
															generate random
															data.
															<a
																href="https://github.com/webroo/dummy-json"
																>Click here to
																see advanced
																usage.
																<Icon
																	type="md-open"></Icon
															></a>
														</p>
													</div>
												</Tooltip>
											</Radio>
										</radio-group>
									</i-col>
								</Row>
								<Row>
									<i-col span="24">
										<Tabs
											:animated="false"
											@on-click="textAreaOnChange"
											v-model="messageInputAreaTab">
											<tab-pane label="Edit" name="Write">
												<i-input
													:autosize="{minRows: 10}"
													@on-change="textAreaOnChange"
													placeholder="Enter the message content here..."
													style="width: 100%"
													type="textarea"
													v-if="messageBodyType=='Plain Text'"
													v-model="textArea.plainTextArea">
												</i-input>
												<i-input
													:autosize="{minRows: 10}"
													@on-change="textAreaOnChange"
													placeholder="Enter the dummy-json template here..."
													style="width: 100%"
													type="textarea"
													v-if="messageBodyType=='Dummy Json'"
													v-model="textArea.dummyJsonArea">
												</i-input>
											</tab-pane>
											<tab-pane
												label="Preview"
												name="Preview"
												v-if="messageBodyType=='Dummy Json'">
												<i-input
													:autosize="{minRows: 10}"
													disabled
													readonly
													style="width: 100%"
													type="textarea"
													v-model="textArea.generatedMessage">
												</i-input>
											</tab-pane>
										</Tabs>
									</i-col>
								</Row>
							</form-item>
							<form-item>
								<i-button
									:disabled="status.isProcessing"
									@click="send()"
									type="primary">
									Send
								</i-button>
							</form-item>
						</i-form>
					</Card>
				</i-col>
			</Row>
			<Modal
				:closable="false"
				:mask-closable="false"
				scrollable
				v-model="status.isProcessing"
				width="380">
				<p slot="header" style="text-align: left">
					<Icon size="18" type="ios-information-circle"></Icon>
					<span>Sending D2C messages...</span>
				</p>
				<div style="text-align: left; margin-left: 24px">
					<p>
						<b>{{status.numberOfSuccessfulMessage}}</b> message(s)
						are successfully sent;
						<br />
						<b>{{status.numberOfFailedMessage}}</b> message(s) are
						failed.
					</p>
					<i-progress
						:percent="Math.round((this.status.numberOfSuccessfulMessage + this.status.numberOfFailedMessage) / this.status.numberOfTotalMessage * 100)"
						status="active">
					</i-progress>
				</div>
				<div slot="footer">
					<div style="width: 80px">
						<i-button
							:disabled="cancelRequested"
							@click="progressCancel"
							style="width: 80px"
							type="primary"
							>{{cancelRequested ? 'Canceling' :
							'Cancel'}}</i-button
						>
					</div>
				</div>
			</Modal>
		</div>
		<script
			src="{{root}}/resources/simulator/scripts/simulator.js"
			type="text/javascript"></script>
	</body>
</html>
